{%- if section.blocks.size > 0 -%}
  <style>
    #shopify-section-{{ section.id }} {
      --testimonials-grid: {% if section.settings.stack_on_mobile %}none{% else %}auto / auto-flow 73vw{% endif %};
      --testimonials-gap: {% if section.settings.gap == 'small' %}var(--grid-gutter){% elsif section.settings.gap == 'medium' %}var(--spacing-12){% elsif section.settings.gap == 'large' %}var(--spacing-20){% else %}var(--spacing-28){% endif %};
    }

    .testimonials-grid {
      display: grid;
      grid: var(--testimonials-grid);
      gap: var(--testimonials-gap);
    }

    @media (min-width: 700px) {
      .testimonials-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }

    .testimonial-card {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      padding: 25px;
      display: flex;
      flex-direction: column;
      gap: 15px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .testimonial-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
    }

    .testimonial-name-row {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .client-name {
      font-size: 18px;
      font-weight: 600;
      color: #333;
    }

    .client-verified {
      display: flex;
      align-items: center;
      gap: 5px;
      color: #00b67a;
      font-size: 13px;
    }

    .verified-icon {
      width: 16px;
      height: 16px;
    }

    .testimonial-stars {
      display: flex;
      gap: 3px;
    }

    .star {
      color: #00b67a;
      font-size: 20px;
    }

    .testimonial-text {
      color: #555;
      line-height: 1.7;
      font-size: 15px;
    }

    @media (max-width: 699px) {
      .testimonial-card {
        padding: 20px;
      }

      .client-name {
        font-size: 16px;
      }

      .testimonial-text {
        font-size: 14px;
      }
    }
  </style>

  <div {% render 'section-properties' %}>
    <div class="section-stack">
      {%- render 'section-header', subheading: section.settings.subheading, heading: section.settings.title, content: section.settings.content, text_alignment: section.settings.text_alignment -%}

      <div class="testimonials-grid scroll-area bleed md:unbleed">
        {%- for block in section.blocks -%}
          <div class="testimonial-card snap-start" {{ block.shopify_attributes }}>
            {%- if block.settings.image != blank -%}
              <div style="width: 100%; aspect-ratio: 1; overflow: hidden; border-radius: 8px; background: #f0f0f0;">
                {%- capture sizes -%}(max-width: 699px) 73vw, 33vw{%- endcapture -%}
                {{- block.settings.image | image_url: width: 600 | image_tag: loading: 'lazy', sizes: sizes, widths: '300,400,500,600', class: 'rounded' -}}
              </div>
            {%- endif -%}

            <div class="testimonial-name-row">
              {%- if block.settings.name != blank -%}
                <div class="client-name">{{ block.settings.name }}</div>
              {%- endif -%}

              {%- if block.settings.verified -%}
                <div class="client-verified">
                  <svg class="verified-icon" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>
                  </svg>
                  Cliente vérifiée
                </div>
              {%- endif -%}
            </div>

            <div class="testimonial-stars">
              <span class="star">★</span>
              <span class="star">★</span>
              <span class="star">★</span>
              <span class="star">★</span>
              <span class="star">★</span>
            </div>

            {%- if block.settings.text != blank -%}
              <div class="testimonial-text">{{ block.settings.text }}</div>
            {%- endif -%}
          </div>
        {%- endfor -%}
      </div>
    </div>
  </div>
{%- endif -%}

{% schema %}
{
  "name": "Témoignages",
  "class": "shopify-section--testimonials",
  "tag": "section",
  "disabled_on": {
    "templates": ["password"],
    "groups": ["header", "custom.overlay"]
  },
  "settings": [
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Full width",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "stack_on_mobile",
      "label": "Stack on mobile",
      "default": false
    },
    {
      "type": "select",
      "id": "gap",
      "label": "Gap spacing",
      "options": [
        {
          "value": "small",
          "label": "Small"
        },
        {
          "value": "medium",
          "label": "Medium"
        },
        {
          "value": "large",
          "label": "Large"
        },
        {
          "value": "x-large",
          "label": "X-Large"
        }
      ],
      "default": "medium"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text alignment",
      "options": [
        {
          "value": "start",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "end",
          "label": "Right"
        }
      ],
      "default": "start"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Heading",
      "default": "Ce que disent nos clientes"
    },
    {
      "type": "richtext",
      "id": "content",
      "label": "Content"
    },
    {
      "type": "header",
      "content": "Colors",
      "info": "Gradient replaces solid colors when set."
    },
    {
      "type": "color",
      "id": "background",
      "label": "Background"
    },
    {
      "type": "color_background",
      "id": "background_gradient",
      "label": "Background gradient"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text"
    }
  ],
  "blocks": [
    {
      "type": "testimonial",
      "name": "Témoignage",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Photo (optionnelle)"
        },
        {
          "type": "text",
          "id": "name",
          "label": "Nom et âge",
          "default": "Cliente, 00"
        },
        {
          "type": "checkbox",
          "id": "verified",
          "label": "Badge vérifiée",
          "default": true
        },
        {
          "type": "textarea",
          "id": "text",
          "label": "Témoignage",
          "default": "Écrivez le témoignage ici..."
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Témoignages",
      "blocks": [
        {
          "type": "testimonial",
          "settings": {
            "name": "Linda T., 49",
            "verified": true,
            "text": "Je suis maman active et j'ai toujours l'air épuisée. Instant Lift+ me sauve la vie !"
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "name": "Jennifer K., 42",
            "verified": true,
            "text": "J'avais des poches sous les yeux tenaces depuis des années. Les poches disparaissent littéralement !"
          }
        },
        {
          "type": "testimonial",
          "settings": {
            "name": "Patricia R., 58",
            "verified": true,
            "text": "Peau sensible, c'est l'enfer. Mais pas Instant Lift+ ! Doux et pourtant efficace."
          }
        }
      ]
    }
  ]
}
{% endschema %}